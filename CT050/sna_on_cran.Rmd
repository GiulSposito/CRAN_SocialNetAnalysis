---
title: "SNA on CRAN Authors"
output: html_notebook
---


## obtendo dados de autores do CRAN

```{r setup, cache=TRUE}
source("cran_author_network.R")
g <- get_CRAN_network()
```

## Analisando os components

```{r whichcomponents}
g <- g %>% # adiciona o peso nas arestas de acordo com o numero de vezes que os autores colabora
  activate("nodes") %>%    # manipulara os nos agora
  mutate(component = as.factor(group_components()))

authors.by.components <- g %>% 
  activate("nodes") %>%
  as.tibble() %>%
  group_by(component) %>%
  summarise( authors=n() ) %>%
  arrange( desc(authors) )

knitr::kable(head(authors.by.components,10))
```

## Comparando 3 componentes "menores"

```{r plotcomponents}
g %>%
  filter( component %in% c(30,33,6) ) %>%
  ggraph(layout="auto") +
  geom_edge_fan(alpha=0.2)+
  geom_node_point(aes(color=component),alpha=0.8, size=1) +
  # geom_node_text(aes(label=name), color="white") +
  theme_void() +
  ggtitle( "Componentes 30, 33 e 6" )

```
```{r compnetworks}

# componentes selecionados para estudo
sel_comps <- c(3,30,33,6)

# para cada um deles
net_metrics <- rbindlist(lapply( sel_comps, function(comp){
  
  h <- g %>% filter( component == comp )

  res <- data.frame(
    component = comp,
    nodes     = h %>% activate("nodes") %>% as.tibble() %>% nrow(),
    density   = round(graph.density(h, loops = F),4),
    diameter  = diameter(h, directed = F, unconnected = F, weights = NULL),
    eccentricity = max(eccentricity(h, mode="all"))/min(eccentricity(h, mode="all"))
  )
  
  return(res)
  
}))

net_metrics

```

### analise de atores 

```{r keyactors1}

h <- g %>%
  activate("nodes") %>%
  filter( component %in% c(30) ) %>%
  mutate(
    degree = centrality_degree(),
    btwn = round(centrality_betweenness(), 2),
    clsn = round(centrality_closeness(normalized = T), 2),
    eign = round(centrality_eigen(scale = T), 2),
    clst = group_edge_betweenness()
  ) %>%
  activate("edges") %>%
  mutate( ebtwn = centrality_edge_betweenness() )

h %>% activate("nodes") %>%
  filter( component==30 ) %>%
  ggraph(layout="auto") +
    geom_edge_fan2(alpha=0.4, aes(edge_colour = ebtwn)) +
    geom_node_point(aes(color=eign, size=degree),alpha=0.9) +
    theme_void() +
    ggtitle( "Combinando Métricas" )


```

```{r filtering}
g <- g %>%
  left_join(aut_list, by="name") %>%
  filter(packages > 5) %>% # pelo menos 4 pacotes
  mutate(Component = group_components()) %>%
  filter(Component == names(table(Component))[which.max(table(Component))])

```

```{r fullplot}
ggraph(g, layout = 'lgl') +
  geom_edge_fan(alpha = 0.1) +
  theme_graph()
```

